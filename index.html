<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Camera Spotting Tour Map</title>

<!-- Leaflet CSS -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
  crossorigin=""
/>

<style>
  html, body {
    height: 100%;
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background: #fff;
  }

  #map {
    width: 100%;
    height: 100%;
  }

  .legend {
    position: absolute;
    top: 12px;
    left: 12px;
    background: rgba(255,255,255,0.95);
    border-radius: 10px;
    padding: 10px 12px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    font-size: 13px;
    line-height: 1.4;
    z-index: 1000;
  }

  .legend-row {
    display: flex;
    align-items: center;
    margin-bottom: 6px;
  }
  .legend-row:last-child {
    margin-bottom: 0;
  }

  .legend-swatch-point {
    width: 12px;
    height: 12px;
    background: #1d4ed8;
    border-radius: 50%;
    border: 2px solid white;
    box-shadow: 0 0 0 1px #1d4ed8;
    margin-right: 6px;
  }

  .legend-swatch-radius {
    width: 12px;
    height: 12px;
    background: rgba(29,78,216,0.15);
    border-radius: 50%;
    border: 1px solid #1d4ed8;
    margin-right: 6px;
  }

  /* Popup styling */
  .popup-wrapper {
    max-width: 240px;
    line-height: 1.4;
    font-size: 14px;
  }

  .popup-title {
    font-weight: 600;
    font-size: 15px;
    margin-bottom: 6px;
  }

  .popup-thumb {
    width: 100%;
    height: auto;
    border-radius: 8px;
    display: block;
    margin-bottom: 8px;
    object-fit: cover;
    background: #ddd;
  }

  .popup-line {
    background: #f5f5f5;
    border-radius: 6px;
    padding: 6px 8px;
    margin-bottom: 4px;
    word-break: break-word;
  }
</style>
</head>

<body>
<div id="map"></div>

<div class="legend">
  <div class="legend-row">
    <div class="legend-swatch-point"></div>
    <div>Camera location</div>
  </div>
  <div class="legend-row">
    <div class="legend-swatch-radius"></div>
    <div>10 m viewing zone</div>
  </div>
</div>

<!-- Leaflet JS -->
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin="">
</script>

<script>
(function(){
  var GEOJSON_URL = 'cameras-new.geojson';

  // 1. Init the map (we'll fit bounds after loading points)
  var map = L.map('map', {
    zoomControl: true
  });

  // 2. Light grey basemap (Carto light_all on OSM data)
  L.tileLayer(
    'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',
    {
      maxZoom: 20,
      attribution: '&copy; OpenStreetMap contributors &copy; CARTO'
    }
  ).addTo(map);

  // We'll collect all latlngs so we can fit bounds
  var allLatLngs = [];

  function buildPopupHTML(props) {
    var cameraType = props.camera_type || 'Camera';
    var imgURL = props.image_url || '';
    var indoorOutdoor = props.indoor_outdoor || '';
    var signage = props.signage_visible || '';

    var html = '<div class="popup-wrapper">';

    // Title (camera_type)
    html += '<div class="popup-title">' + cameraType + '</div>';

    // Thumbnail image (image_url)
    if (imgURL) {
      html += '<img class="popup-thumb" src="' + imgURL + '" alt="Camera image" />';
    }

    // indoor_outdoor
    if (indoorOutdoor) {
      html += '<div class="popup-line"><strong>Indoors / Outdoors:</strong> ' + indoorOutdoor + '</div>';
    }

    // signage_visible
    if (signage) {
      html += '<div class="popup-line"><strong>Signage visible?:</strong> ' + signage + '</div>';
    }

    html += '</div>';
    return html;
  }

  // 3. Load the GeoJSON with your cameras
  fetch(GEOJSON_URL)
    .then(function(resp){
      if (!resp.ok) throw new Error('Failed to load ' + GEOJSON_URL + ' (' + resp.status + ')');
      return resp.json();
    })
    .then(function(geojson){

      // Add each feature as a circleMarker + 10m radius circle
      var layer = L.geoJSON(geojson, {
        pointToLayer: function (feature, latlng) {
          var props = feature.properties || {};

          // main visible marker
          var marker = L.circleMarker(latlng, {
            radius: 6,
            color: '#ffffff',
            weight: 2,
            fillColor: '#1d4ed8',
            fillOpacity: 0.8
          });

          // attach popup
          marker.bindPopup(buildPopupHTML(props));

          // 50m radius circle
          var circle = L.circle(latlng, {
            radius: 10,
            color: '#1d4ed8',
            weight: 1,
            fillColor: '#1d4ed8',
            fillOpacity: 0.15
          });
          circle.addTo(map);

          // collect for fitBounds
          allLatLngs.push(latlng);

          return marker;
        }
      }).addTo(map);

      // Zoom map to all collected points
      if (allLatLngs.length > 0) {
        var bounds = L.latLngBounds(allLatLngs);
        map.fitBounds(bounds.pad(0.2));
      } else {
        // fallback (Amsterdam-ish)
        map.setView([52.3725, 4.9175], 17);
      }
    })
    .catch(function(err){
      console.error(err);
      alert('Could not load cameras-new.geojson. See console for details.');
    });

})();
</script>


</body>
</html>
