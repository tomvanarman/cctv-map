<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Camera Spotting Tour Map</title>

<!-- Leaflet CSS -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
  crossorigin=""
/>

<style>
  html, body {
    height: 100%;
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background: #fff;
  }
  #map {
    width: 100%;
    height: 100%;
  }

  .popup-content {
    max-width: 260px;
    line-height: 1.4;
    font-size: 14px;
  }

  .popup-content img {
    width: 100%;
    height: auto;
    border-radius: 8px;
    display: block;
    margin-bottom: 8px;
    object-fit: cover;
  }

  .popup-meta {
    background: #f5f5f5;
    border-radius: 6px;
    padding: 6px 8px;
    margin-bottom: 4px;
    word-break: break-word;
  }

  .legend {
    position: absolute;
    top: 12px;
    left: 12px;
    background: rgba(255,255,255,0.95);
    border-radius: 10px;
    padding: 10px 12px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    font-size: 13px;
    line-height: 1.4;
    z-index: 1000;
  }

  .legend-row {
    display: flex;
    align-items: center;
    margin-bottom: 6px;
  }
  .legend-row:last-child {
    margin-bottom: 0;
  }
  .legend-swatch-point {
    width: 12px;
    height: 12px;
    background: #1d4ed8;
    border-radius: 50%;
    border: 2px solid white;
    box-shadow: 0 0 0 1px #1d4ed8;
    margin-right: 6px;
  }
  .legend-swatch-radius {
    width: 12px;
    height: 12px;
    background: rgba(29,78,216,0.15);
    border-radius: 50%;
    border: 1px solid #1d4ed8;
    margin-right: 6px;
  }
</style>
</head>

<body>
<div id="map"></div>

<div class="legend">
  <div class="legend-row">
    <div class="legend-swatch-point"></div>
    <div>Camera location</div>
  </div>
  <div class="legend-row">
    <div class="legend-swatch-radius"></div>
    <div>50 m radius</div>
  </div>
</div>

<!-- Leaflet JS -->
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin="">
</script>

<script>
// Path to your new GeoJSON file
var GEOJSON_URL = 'cameras-new.geojson';

// 1. init map
var map = L.map('map', {
  zoomControl: true
});

// Add OSM baselayer
var osm = L.tileLayer(
  'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
  {
    maxZoom: 20,
    attribution: '&copy; OpenStreetMap contributors'
  }
).addTo(map);

// We'll collect bounds as we add features
var featureBounds = [];

function makePopupHTML(props) {
  var html = '<div class="popup-content">';

  // image
  if (props.image_url) {
    html += '<img src="' + props.image_url + '" alt="Camera photo" />';
  }

  // title
  if (props.title) {
    html += '<div class="popup-meta"><strong>' + props.title + '</strong></div>';
  }

  // camera type
  if (props.camera_type) {
    html += '<div class="popup-meta"><strong>Type:</strong> ' + props.camera_type + '</div>';
  }

  // indoor/outdoor
  if (props.indoor_outdoor) {
    html += '<div class="popup-meta"><strong>Indoors / Outdoors:</strong> ' + props.indoor_outdoor + '</div>';
  }

  // signage
  if (props.signage_visible) {
    html += '<div class="popup-meta"><strong>Signage visible?:</strong> ' + props.signage_visible + '</div>';
  }

  // accuracy
  if (props.accuracy_m !== undefined && props.accuracy_m !== null) {
    html += '<div class="popup-meta"><strong>GPS accuracy (m):</strong> ' + props.accuracy_m + '</div>';
  }

  // timestamps
  if (props.created_at) {
    html += '<div class="popup-meta"><strong>Recorded:</strong> ' + props.created_at + '</div>';
  }
  if (props.uploaded_at) {
    html += '<div class="popup-meta"><strong>Uploaded:</strong> ' + props.uploaded_at + '</div>';
  }

  html += '</div>';
  return html;
}

// 2. load the geojson
fetch(GEOJSON_URL)
  .then(function(resp){
    if (!resp.ok) throw new Error('Failed to load ' + GEOJSON_URL + ' (' + resp.status + ')');
    return resp.json();
  })
  .then(function(geojson){

    // create layer for markers
    var markerLayer = L.geoJSON(geojson, {
      pointToLayer: function (feature, latlng) {
        // visible point marker
        var marker = L.circleMarker(latlng, {
          radius: 6,
          color: '#ffffff',
          weight: 2,
          fillColor: '#1d4ed8',
          fillOpacity: 0.8
        });

        // popup content
        var props = feature.properties || {};
        marker.bindPopup(makePopupHTML(props));

        // also draw 50m radius circle
        var circle = L.circle(latlng, {
          radius: 50, // meters
          color: '#1d4ed8',
          weight: 1,
          fillColor: '#1d4ed8',
          fillOpacity: 0.15
        });

        circle.addTo(map);

        // track for bounds
        featureBounds.push(latlng);

        return marker;
      }
    }).addTo(map);

    // fit map to all features/circles
    if (featureBounds.length > 0) {
      var bounds = L.latLngBounds(featureBounds);
      map.fitBounds(bounds.pad(0.2)); // little padding
    } else {
      // fallback center (Amsterdam-ish)
      map.setView([52.3725, 4.9175], 17);
    }

  })
  .catch(function(err){
    console.error(err);
    alert('Could not load cameras-new.geojson. See console for details.');
  });
</script>

</body>
</html>
