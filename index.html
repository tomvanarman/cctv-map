<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Camera Spotting Tour Map</title>

<!-- Leaflet CSS -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
  crossorigin=""
/>

<style>
  html, body, #map {
    height: 100%;
    margin: 0;
  }

  .popup-content {
    max-width: 260px;
    font: 14px/1.4 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }

  .popup-content img {
    width: 100%;
    height: auto;
    border-radius: 8px;
    display: block;
    margin-bottom: 8px;
  }

  .popup-meta {
    background: #f5f5f5;
    border-radius: 6px;
    padding: 8px;
  }

  .popup-meta div {
    margin-bottom: 4px;
    word-break: break-word;
  }

  .legend {
    position: absolute;
    top: 12px;
    left: 12px;
    z-index: 1000;
    background: rgba(255,255,255,0.95);
    border-radius: 10px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    padding: 10px 12px;
    font: 13px/1.4 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }

  .legend-row {
    display: flex;
    align-items: center;
    margin-bottom: 6px;
  }
  .legend-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #1d4ed8;
    border: 2px solid white;
    box-shadow: 0 0 3px rgba(0,0,0,0.4);
    margin-right: 6px;
  }
  .legend-circle {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid rgba(29,78,216,0.4);
    margin-right: 6px;
  }

</style>
</head>
<body>

<div id="map"></div>

<div class="legend">
  <div class="legend-row">
    <div class="legend-dot"></div>
    <div>Camera location</div>
  </div>
  <div class="legend-row">
    <div class="legend-circle"></div>
    <div>~50m area</div>
  </div>
</div>

<!-- Leaflet JS -->
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9XMBeXV8qGGbY6H94C4="
  crossorigin=""
></script>

<script>
  // Initial map view (fallback before data loads)
  var map = L.map('map').setView([52.3729, 4.9173], 17);

  // Basemap: you can swap this to any tile service you prefer.
  // Using Carto light basemap (no API key needed).
  L.tileLayer(
    'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',
    {
      maxZoom: 20,
      attribution:
        '&copy; OpenStreetMap contributors &copy; CARTO'
    }
  ).addTo(map);

  // Helper to build popup HTML for each feature
  function buildPopupHTML(props) {
    var title = props.title || 'Camera';
    var camType = props.camera_type || '';
    var indoor = props.indoors_outdoors || '';
    var signage = props.camera_sign || '';
    var accuracy = (props.accuracy_m !== undefined && props.accuracy_m !== null)
        ? props.accuracy_m + ' m'
        : '';
    var img = props.image_url
        ? '<img src="' + props.image_url + '" alt="camera photo" loading="lazy" />'
        : '';

    var metaRows = '';
    if (camType)   metaRows += '<div><strong>Type:</strong> ' + camType + '</div>';
    if (indoor)    metaRows += '<div><strong>Indoors/Outdoors:</strong> ' + indoor + '</div>';
    if (signage)   metaRows += '<div><strong>Camera signage visible?</strong> ' + signage + '</div>';
    if (accuracy)  metaRows += '<div><strong>GPS accuracy:</strong> ' + accuracy + '</div>';
    if (props.created_at)  metaRows += '<div><strong>Spotted at:</strong> ' + props.created_at + '</div>';

    var html =
      '<div class="popup-content">' +
        img +
        '<div class="popup-meta">' +
          '<div><strong>' + title + '</strong></div>' +
          metaRows +
        '</div>' +
      '</div>';

    return html;
  }

  // Load the GeoJSON you saved
  fetch('camera-spotting-tour.geojson')
    .then(function(res){
      if(!res.ok) { throw new Error('Could not load camera-spotting-tour.geojson'); }
      return res.json();
    })
    .then(function(geojson){
      var bounds = [];

      // We'll create a LayerGroup so we can add marker + circle per feature
      var group = L.layerGroup();

      (geojson.features || []).forEach(function(feat){
        if (!feat.geometry || feat.geometry.type !== 'Point') return;
        var coords = feat.geometry.coordinates;
        if (!Array.isArray(coords) || coords.length < 2) return;

        var lng = coords[0];
        var lat = coords[1];
        var props = feat.properties || {};

        // Marker
        var marker = L.circleMarker([lat, lng], {
          radius: 6,
          color: '#ffffff',
          weight: 2,
          fillColor: '#1d4ed8',
          fillOpacity: 0.8
        });

        // Popup on marker
        marker.bindPopup(buildPopupHTML(props), {
          maxWidth:
